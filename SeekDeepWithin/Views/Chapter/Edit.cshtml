@model SeekDeepWithin.Models.ChapterViewModel

@{
   var title = Model.SubBook.Version.Title;
   if (Model.SubBook.Name != "default"){
      title += " | " + Model.SubBook.Name;
   }
   title += " | " + Model.Name;
   ViewBag.Title = "Edit " + title;
}
<h3>
   <small>editing</small> @title
</h3>
@using (Html.BeginForm (null, null, FormMethod.Post, new { id = "__AjaxAntiForgeryForm" })){
   @Html.AntiForgeryToken()
}

<div id="modal" class="reveal-modal" data-reveal></div>
@Html.Hidden("chapterId", Model.Id)
<input type="hidden" id="FooterIndex" name="FooterIndex" value="-1" />
<input type="hidden" id="itemType" name="itemType" value="Passage" />

<div class="row">
   <div class="small-4 large-2 columns">
      <strong>reading style</strong><span id="saveReadStyleCheck"><i class="icon-ok-sign" style="color: green"></i></span>
   </div>
   <div class="small-4 large-2 columns text-right">
      <div class="switch tiny">
         <i class="icon-numberlist"></i>
         <input id="verseRadio" type="radio" name="versePara"@if(!Model.DefaultToParagraph){<text> checked</text>}>
         <label for="verseRadio"></label>
      </div>
   </div>
   <div class="small-4 large-2 columns text-left">
      <div class="switch tiny">
         <i class="icon-align-left"></i>
         <input id="paraRadio" type="radio" name="versePara"@if(Model.DefaultToParagraph){<text> checked</text>}>
         <label for="paraRadio"></label>
      </div>
   </div>
   <div class="small-12 large-6 columns text-right">
      <small>@Html.ActionLink("read", "Read", new { id = Model.Id }, new {@class="button tiny"})</small>
      @if (Request.IsAuthenticated && User.IsInRole ("Creator")) {
         <small>@Html.ActionLink("add passages", "Add", new { id = Model.Id }, new {@class="button tiny success"})</small>
      }
   </div>
</div>

<div class="row">
   <div class="small-12 large-12 columns text-center">
      <a href="#" onclick="header_CreateChapter();" class="button success tiny">Add Header for Chapter</a>
   </div>
</div>

<div id="chapterHeaders">
   @Html.EditorFor(model => model.Headers)
</div>

<div class="off-canvas-wrap" data-offcanvas>
   <div class="inner-wrap">
      <nav class="tab-bar">
         <section class="left-small text-center">
            <a class="left-off-canvas-toggle" href="#" style="color: black;"><i class="icon-menu"></i></a>
         </section>

         <section class="middle tab-bar-section">
            <h1 class="title">Passages - <span id="editPassNum"></span> <small>(passage id: <span id="editPassId"></span> entry id: <span id="editEntryId"></span>)</small></h1>
         </section>
         
         <section class="right-small text-center">
            <a class="right-off-canvas-toggle" href="#" style="color: black;"><i class="icon-menu"></i></a>
         </section>
      </nav>

      <aside class="left-off-canvas-menu">
         <ul class="off-canvas-list">
            <li><label>Passages</label></li>
            @foreach (var passage in Model.Passages) {
               var len = passage.Text.Length > 20 ? 20 : passage.Text.Length;
               <li>
                  <a href="#" onclick="editEntry(@passage.EntryId)">@passage.Number - @passage.Text.Substring(0, len)...</a>
               </li>
            }
         </ul>
      </aside>
      
      <aside class="right-off-canvas-menu">
         <ul class="off-canvas-list" id="rightMenu">
            <li id="headersLabel"><label>Headers</label></li>
            <li id="addHeaderBtn"><a href="#" onclick="header_CreatePassage();">Add New Header</a></li>
            <li id="footersLabel"><label>Footers</label></li>
            <li id="addFooterBtn"><a href="#" onclick="footer_CreatePassage();">Add New Footer</a></li>
            <li id="endLabel"><label>Seek Deep Within</label></li>
         </ul>
      </aside>

      <section class="main-section">

         <div class="row">
            <div class="small-12 large-12 columns">
               <textarea cols="10" id="passText" name="passText" rows="6" style="margin-top: 10px;"></textarea>
            </div>
         </div>

         <div class="row">
            <div class="small-12 large-2 columns">
               <a href="#" class="button tiny" onclick="savePassage();">Save</a>
               <span id="saveCheck"><i class="icon-ok-sign" style="color: green"></i> Success!</span>
            </div>
            <div class="small-12 large-5 columns">
               <div class="row collapse prefix-radius">
                  <div class="small-3 columns">
                     <span class="prefix">Start</span>
                  </div>
                  <div class="small-9 columns">
                     <input type="number" id="StartIndex" name="StartIndex" readonly />
                  </div>
               </div>
            </div>
            <div class="small-12 large-5 columns">
               <div class="row collapse prefix-radius">
                  <div class="small-3 columns">
                     <span class="prefix">End</span>
                  </div>
                  <div class="small-9 columns">
                     <input type="number" id="EndIndex" name="EndIndex" readonly />
                  </div>
               </div>
            </div>
         </div>
         
         <div class="row">
            <div class="small-12 large-6 columns">
               <h4>New Link</h4>
               @Html.Partial("_LinkForm", new SeekDeepWithin.Models.EditLinkViewModel { Type = "Passage" })
            </div>
            <div class="small-12 large-6 columns">
               <h4>New Style</h4>
               @Html.Partial("_StyleView")
            </div>
         </div>

      </section>

      <a class="exit-off-canvas"></a>

   </div>
</div>


<div class="row">
   <div class="small-12 large-12 columns text-center">
      <a href="#" onclick="footer_CreateChapter();" class="button success tiny">Add Footer for Chapter</a>
   </div>
</div>

<div id="chapterFooters">
   @Html.EditorFor(model => model.Footers)
</div>

@section Scripts {
   @Scripts.Render("~/bundles/jqueryval")
   @Scripts.Render("~/bundles/jqueryui")
   @Scripts.Render("~/bundles/sdw.editchapter")
   @if (Model.Passages.Count > 0) {
      <script type="text/javascript">
         $(document).ready(function() {
            editEntry(@Model.Passages.First().EntryId);
         });
      </script>
   }
}
