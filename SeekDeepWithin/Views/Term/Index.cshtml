@using SeekDeepWithin.Controllers
@model SeekDeepWithin.Models.TermViewModel

@{
   ViewBag.Title = Model.Name;
   var scheme = Request.Url == null ? string.Empty : Request.Url.Scheme;
   var tags = Model.Links.Where (l => l.LinkType == TermLinkType.Tag).ToList ();
   var tagged = Model.Links.Where (l => l.LinkType == TermLinkType.Tagged).ToList ();
   var writers = Model.Links.Where (l => l.LinkType == TermLinkType.Writer).ToList ();
   var written = Model.Links.Where (l => l.LinkType == TermLinkType.Written).ToList ();
   var seeAlsos = Model.Links.Where (l => l.LinkType == TermLinkType.SeeAlso).ToList ();
}
@section featured {
   <div class="panel">
      <div class="row">
         <div class="small-12 columns tCenter">
            <h3>@Model.Name</h3>
         </div>
      </div>
   </div>
}
<div class="row">
   <div class="small-12 large-8 columns">
      @if (Model.Book != null) {
         <div class="sdw-panel">
            <div class="title">Book | 
               @Model.Book.Title
               @if (!string.IsNullOrWhiteSpace (Model.Book.SubTitle)) {
                  <small>@Model.Book.SubTitle</small>
               }
               @if (Request.IsAuthenticated && User.IsInRole ("Editor")) {
                  <span style="float: right;">
                     <a href="@Url.Action("Edit", "Book", new {id = Model.Book.Id}, scheme)" title="Edit Book" class="sdw-button alt icon">
                        <i class="icon-edit"></i>
                     </a>
                  </span>
               }
            </div>
            <div class="content">@Model.Book.Summary</div>
            <div class="row">
               <div class="small-12 medium-4 medium-offset-4 large-4 large-offset-4 columns">
                  <a href="@Url.Action("Index", "Read", new {}, scheme)" class="sdw-button reg expand small mBottom">
                     <i class="icon-book"></i> read
                  </a>
               </div>
            </div>
         </div>
      }
      @if (Model.Items.Count == 0 && Model.Book == null) {
         <div class="sdw-callout"><em>No information has been added for this term! Sorry!</em></div>
      }
      @foreach (var item in Model.Items) {
         <div id="item_@item.Id">
            <div class="row">
               <div class="small-12 large-12 columns">
                  <div class="sdw-panel" style="margin-bottom: 0;">
                     <div class="title">
                        <a href="@Url.Action("Index", "Glossary", new {sourceId=item.SourceId}, scheme)">
                           @item.SourceName
                        </a>
                        @if (Request.IsAuthenticated && User.IsInRole ("Editor")) {
                           <span style="float: right;">
                              <a href="@Url.Action("Delete", "TermItem", new {id = item.Id}, scheme)" title="Delete Item" class="sdw-button err icon">
                                 <i class="icon-trash"></i>
                              </a>
                              <a href="@Url.Action("Edit", "TermItem", new {id = item.Id}, scheme)" title="Edit Item" class="sdw-button alt icon">
                                 <i class="icon-edit"></i>
                              </a>
                           </span>
                        }
                     </div>
                     <div class="content">
                        @foreach (var entry in item.Entries) {
                           @(Html.Partial ("_GlossaryEntry", entry))
                        }
                     </div>
                  </div>
               </div>
            </div>
         </div>
      }
      @if (tagged.Count > 0) {
         bool rowStart = true;
         <div class="sdw-panel">
            <div class="title">This is tagged in:</div>
            <div class="content">
               @foreach (var tag in tagged) {
                  if (rowStart) {
                     @Html.Raw("<div class=\"row\">")
                  }
                  <div class="small-12 medium-6 large-6 columns">
                     <a href="@Url.Action("Index", "Term", new {id=tag.RefId}, scheme)" class="sdw-button white expand">
                        @(tag.Name)
                     </a>
                  </div>
                  if (!rowStart) {
                     @Html.Raw("</div>")
                  }
                  rowStart = !rowStart;
               }
               @if (!rowStart) {
                  @Html.Raw("</div>")
               }
            </div>
         </div>
      }
   </div>
   <div class="small-12 large-4 columns">
      @if (writers.Count > 0) {
         <div class="row">
            <div class="small-12 large-12 columns">
               <div class="sdw-panel">
                  <div class="title">Written By</div>
                  @foreach(var writer in writers) {
                     <a href="@Url.Action("Index", "Term", new { id = writer.RefId }, scheme)" class="sdw-button white small expand">
                        @writer.Name
                     </a>
                  }
               </div>
            </div>
         </div>
      }
      @if (written.Count > 0) {
         <div class="row">
            <div class="small-12 large-12 columns">
               <div class="sdw-panel">
                  <div class="title">@(Model.Name) has written</div>
                  @foreach(var wrote in written) {
                     <a href="@Url.Action("Index", "Term", new { id = wrote.RefId }, scheme)" class="sdw-button white small expand">
                        @wrote.Name
                     </a>
                  }
               </div>
            </div>
         </div>
      }
      @if (tags.Count > 0) {
         <div class="row">
            <div class="small-12 large-12 columns">
               <div class="sdw-panel">
                  <div class="title">Tags</div>
                  @foreach(var tag in tags) {
                     <a href="@Url.Action("Index", "Term", new { id = tag.RefId }, scheme)" class="sdw-button white small expand">
                        @tag.Name
                     </a>
                  }
               </div>
            </div>
         </div>
      }
      @if (seeAlsos.Count > 0) {
         <div class="row">
            <div class="small-12 large-12 columns">
               <div class="sdw-panel">
                  <div class="title">See Also</div>
                  @foreach(var seeAlso in seeAlsos) {
                     <a href="@Url.Action("Index", "Term", new {id=seeAlso.RefId}, scheme)" class="sdw-button white small expand">
                        @seeAlso.Name
                     </a>
                  }
               </div>
            </div>
         </div>
      }
      @if (Request.IsAuthenticated && User.IsInRole ("Creator")) {
         <div class="row">
            <div class="small-12 columns">
                  <a href="@Url.Action("Create", "TermItem", new {termId = Model.Id}, scheme)" class="sdw-button add expand tiny mBottom">
                     <i class="icon-plus"></i> add item
                  </a>
            </div>
         </div>
      }
      @if (Request.IsAuthenticated && User.IsInRole ("Editor")) {
         <div class="row">
            <div class="small-12 columns">
               <a href="@Url.Action("Edit", "Term", new {id = Model.Id}, scheme)" class="sdw-button alt expand tiny mBottom">
                  <i class="icon-edit"></i> edit this term
               </a>
            </div>
         </div>
         foreach (var link in Model.Links) {
            if (link.LinkType == TermLinkType.Version || link.LinkType == TermLinkType.SubBook) {
               var linkType = link.LinkType.ToString ();
               <div class="row">
                  <div class="small-12 columns">
                     <a href="@Url.Action("Edit", linkType, new {id = link.RefId}, scheme)" class="sdw-button alt expand tiny mBottom">
                        <i class="icon-edit"></i> edit @(linkType.ToLower ())
                     </a>
                  </div>
               </div>
            }
         }
      }
   </div>
</div>
